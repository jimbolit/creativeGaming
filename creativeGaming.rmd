---
title: "ASSIGNMENT NAME"      # Replace with name of assignment
author: 
   - name: Section 81         # Replace with your section number
   - name: James Little
   - name: Mario Estrada
   - name: Greg Schiffenhaus       # add/delete rows for more/fewer names as needed. 
output:
  html_notebook: default
---

# Preliminaries

### Determine notebook defaults:
```{r, include=FALSE}
knitr::opts_chunk$set(echo=TRUE,      # Print all the code in all the chunks
                      warning=FALSE,  # Don't print warning statements
                      message=FALSE,  # Don't print other R output messages
                      comment=NA)     # Helps produce prettier output
```

### Load packages:
```{r, echo=FALSE, message = FALSE, warning = FALSE}
library(gmodels)
library(modelr)
library(janitor)
library(haven)
library(readxl)
library(knitr)
library(psych)
library(statar)
library(tidyverse)
library(sjPlot)
library(mktg482) 
library(openxlsx)
library(scales)
library(dplyr)
library(skimr)
```

### Read in the data:
```{r}
load("creative_gaming.Rdata") 
```

# Assignment answers

### Part I

### Question 1

What is the organic probability of converting to Zalon?

```{r}
organicConvertVar <- (cg_organic %>% summarise(organicConvert = mean(converted)))$organicConvert
cat("Organic probability of converting to Zalon: ", percent(organicConvertVar, .01))
```

### Question 2

For each feature, show basic summary statistics.

```{r}
skim_without_charts(cg_organic)
```

## Part II

## Question 1

Create a training and test sample based on the “cg_organic” dataframe. What is the training/test split?

```{r}
cg_organic_train <- cg_organic[sample_train_org,] 
cg_organic_test <- cg_organic[-sample_train_org,]

nrow(cg_organic_train)
nrow(cg_organic_train)/nrow(cg_organic)
nrow(cg_organic_test)
nrow(cg_organic_test)/nrow(cg_organic)

```

## Question 2

Train a logistic regression model using all features

```{r}
 lr <- glm(converted ~ GameLevel + NumGameDays + NumGameDays4Plus + NumInGameMessagesSent + NumFriends + NumFriendRequestIgnored + NumSpaceHeroBadges + AcquiredSpaceship + AcquiredIonWeapon + TimesLostSpaceship + TimesKilled + TimesCaptain + TimesNavigator + PurchasedCoinPackSmall + PurchasedCoinPackLarge + NumAdsClicked + DaysUser + UserNoConsole + UserHasOldOS , data = cg_organic_train)
summary(lr)

```
```{r}
plot_model(lr, show.values = TRUE, transform = NULL)
```


```{r fig2, fig.height = 3, fig.width = 3, fig.align = "center"}
plot_model(lr, type= "eff")
```

```{r}
varimp.logistic(lr) %>% plotimp.logistic()
```

The 5 most important features are
- Number of space hero badges: the more badges the more likely to purchase
- Number of friend requests ignored: more friend requests ignored means less likely to purchase
- Times lost spaceship: more times a spaceship has been lost the less likely to purchase
- Acquired ion weapon: acquired ion weapon means more likely to purchase
- Acquired spaceship: acquired spaceship means more likely to purchase

``` {r}
pred_lr_test <- predict(lr, newdata=cg_organic_test, type="response")
gainsplot(pred_lr_test, label.var = cg_organic_test$converted)
```


## Part 3

### Question 1

Calculate the response rate and profit of the control group not sent an ad

```{r}
revenuePerPurchase <- 14.99
costToServeAd <- 1.5

controlConvertVar <- (cg_organic_control %>% summarise(controlConvert = mean(converted)))$controlConvert
cat("Control response rate to Zalon: ", percent(controlConvertVar, .01))

profitControl <- nrow(cg_organic_control) * controlConvertVar* revenuePerPurchase
cat("\nProfit: ", dollar(profitControl, .01))

```

### Question 2

Calculate the response rate and profit of the randomly selected customers who were sent the ad

```{r}
cg_ad_random <- cg_ad_treatment[sample_random_30000,]

adConvertVar <- (cg_ad_random %>% summarise(adConvert = mean(converted)))$adConvert
cat("Ad treatment response rate to Zalon: ", percent(adConvertVar, .01))

profitAd <- nrow(cg_ad_random) * (adConvertVar* revenuePerPurchase - costToServeAd)
cat("\nProfit: ", dollar(profitAd, .01))
```

### Question 3

 Calculate the response rate and profit of the customers from the remaining sample with the highest probability to buy according to the model
 
```{r}
cg_ad_scoring <- cg_ad_treatment[-sample_random_30000,]

cg_ad_scoring <- cg_ad_scoring %>% mutate(pred_prob = predict(lr, newdata=cg_ad_scoring, type="response"))

cg_ad_scoring <- cg_ad_scoring %>% arrange(desc(pred_prob))

cg_best <- head(cg_ad_scoring, 30000)


```


```{r}
bestConvertVar <- (cg_best %>% summarise(bestConvert = mean(converted)))$bestConvert
cat("Ad treatment response rate to Zalon: ", percent(bestConvertVar, .01))

profitBest <- nrow(cg_best) * (bestConvertVar* revenuePerPurchase - costToServeAd)
cat("\nProfit: ", dollar(profitBest, .01))
```


### Question 4

In summary:

- without any advertising, we can expect 5.7% of people to buy Zalon. Across 30,000 people this equates to ~$26K in profits

- with advertising to everyone, we can expect 13.0% of people to buy Zalon. Across a sample of 30,000 people this equates to ~$14K in profits

- with targeted advertising to the most likely 30,000 people from a set of 120,000 we can expect 21.0% of people to buy Zalon, and a profit of ~$49K














